import OpenAI from 'openai';

const openai = new OpenAI({
  apiKey: process.env.OPENAI_API_KEY || 'fallback-key'
});

export class AIService {
  private isEnabled(): boolean {
    return !!process.env.HUGGINGFACE_API_KEY || !!process.env.GEMINI_API_KEY;
  }

  private shouldUseGemini(): boolean {
    return this.isEnabled() && !!process.env.GEMINI_API_KEY;
  }

  private shouldUseHuggingFace(): boolean {
    return !this.shouldUseGemini() && !!process.env.HUGGINGFACE_API_KEY;
  }

  private async callGeminiAPI(prompt: string, analysisType: string = 'general'): Promise<string> {
    if (!this.isEnabled()) {
      throw new Error('Gemini API not available');
    }

    const enhancedPrompt = this.enhancePromptForDeepAnalysis(prompt, analysisType);
    
    try {
      const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${process.env.GEMINI_API_KEY}`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          contents: [{
            parts: [{
              text: enhancedPrompt
            }]
          }],
          generationConfig: {
            temperature: 0.7,
            topK: 40,
            topP: 0.95,
            maxOutputTokens: 2048,
          }
        })
      });

      if (!response.ok) {
        throw new Error(`Gemini API error: ${response.status}`);
      }

      const data = await response.json();
      
      if (data.candidates && data.candidates[0] && data.candidates[0].content) {
        return data.candidates[0].content.parts[0].text;
      }
      
      throw new Error('Invalid response from Gemini API');
    } catch (error) {
      console.error('Gemini API error:', error);
      throw error;
    }
  }

  private enhancePromptForDeepAnalysis(originalPrompt: string, analysisType: string): string {
    const contextualEnhancements = {
      'sales': 'ุฑูุฒ ุนูู ุงูุงุชุฌุงูุงุชุ ุงูุฃููุงุท ุงูููุณููุฉุ ููุฑุต ุงูููู',
      'product': 'ุญูู ุงูุฃุฏุงุกุ ุงูููุงูุณุฉุ ูุงูุชุญุณููุงุช ุงููุทููุจุฉ',
      'customer': 'ุงุนุท ุฃููููุฉ ูุณููู ุงูุนููุงุกุ ุงูุชูุถููุงุชุ ููุฑุต ุงูุชูุงุนู',
      'business': 'ูุฏู ุชุญููู ุดุงูู ูููุถุน ุงูุญุงูู ูุงูุชูุตูุงุช ุงูุงุณุชุฑุงุชูุฌูุฉ',
      'general': 'ูุฏู ุชุญููู ูุชูุงุฒู ูุบุทู ุฌููุน ุฌูุงูุจ ุงูุนูู'
    };

    const enhancement = contextualEnhancements[analysisType as keyof typeof contextualEnhancements] || contextualEnhancements['general'];
    
    return `${originalPrompt}

ุชุนูููุงุช ุฅุถุงููุฉ ููุชุญููู ุงููุชูุฏู:
- ${enhancement}
- ุงุณุชุฎุฏู ุงูุจูุงูุงุช ุงููุชุงุญุฉ ูุชูุฏูู ุฑุคู ูุงุจูุฉ ููุชูููุฐ
- ุงุฑุจุท ุงูุชุญููู ุจุงูุณูุงู ุงููุญูู ูุงูุซูุงูู ุงูุนุฑุจู
- ูุฏู ุชูุตูุงุช ูุญุฏุฏุฉ ููุงุจูุฉ ููููุงุณ
- ุงุนุชุจุฑ ุงูุชุญุฏูุงุช ูุงููุฑุต ูู ุงูุณูู ุงูุญุงูู

ุฃุฌุจ ุจุงููุบุฉ ุงูุนุฑุจูุฉ ุจุฃุณููุจ ูููู ูููุตู.`;
  }

  private async callHuggingFace(model: string, inputs: any): Promise<any> {
    const response = await fetch(`https://api-inference.huggingface.co/models/${model}`, {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${process.env.HUGGINGFACE_API_KEY}`,
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({ inputs })
    });

    if (!response.ok) {
      throw new Error(`HuggingFace API error: ${response.status}`);
    }

    return await response.json();
  }

  private async generateTextWithHF(prompt: string): Promise<string> {
    try {
      if (this.shouldUseGemini()) {
        return await this.callGeminiAPI(prompt, 'general');
      }

      if (this.shouldUseHuggingFace()) {
        const result = await this.callHuggingFace('microsoft/DialoGPT-large', prompt);
        return result.generated_text || result[0]?.generated_text || 'ูุง ูููู ุชูููุฏ ุฅุฌุงุจุฉ ูู ุงูููุช ุงูุญุงูู';
      }

      throw new Error('No AI service available');
    } catch (error) {
      console.error('Error generating text:', error);
      throw error;
    }
  }

  // ุชุญููู ุฃุฏุงุก ุงููุจูุนุงุช ูุน ุงูุฐูุงุก ุงูุงุตุทูุงุนู
  async analyzeSalesPerformance(salesData: any): Promise<{
    insights: string[];
    trends: string[];
    recommendations: string[];
  }> {
    try {
      if (!this.isEnabled()) {
        return {
          insights: ['ุชุญููู ุงููุจูุนุงุช ุบูุฑ ูุชุงุญ'],
          trends: ['ุงูุงุชุฌุงูุงุช ุบูุฑ ูุชููุฑุฉ'],
          recommendations: ['ุงูุชูุตูุงุช ุบูุฑ ูุชุงุญุฉ']
        };
      }

      const prompt = `ูู ุจุชุญููู ุจูุงูุงุช ุงููุจูุนุงุช ุงูุชุงููุฉ ููุฏู ุฑุคู ุนูููุฉ:
      
ุงูุจูุงูุงุช: ${JSON.stringify(salesData)}

ูุฏู ุชุญูููุงู ุดุงููุงู ูุดูู:
1. ุงูุฑุคู ุงููููุฉ ูู ุงูุจูุงูุงุช
2. ุงูุงุชุฌุงูุงุช ูุงูุฃููุงุท
3. ุงูุชูุตูุงุช ููุชุญุณูู

ุฃุฌุจ ุจุตูุบุฉ JSON ูุน ุงูููุงุชูุญ: insights, trends, recommendations`;

      const response = await this.generateTextWithHF(prompt);
      
      try {
        const analysis = JSON.parse(response);
        return {
          insights: analysis.insights || ['ุชู ุชุญููู ุงูุจูุงูุงุช ุจูุฌุงุญ'],
          trends: analysis.trends || ['ุงุชุฌุงูุงุช ุฅูุฌุงุจูุฉ ูู ุงููุจูุนุงุช'],
          recommendations: analysis.recommendations || ['ููุงุตูุฉ ุงูุงุณุชุฑุงุชูุฌูุฉ ุงูุญุงููุฉ']
        };
      } catch {
        return {
          insights: [response.split('\n')[0] || 'ุชุญููู ุนุงู ูููุจูุนุงุช'],
          trends: ['ููู ูุณุชูุฑ ูู ุงููุจูุนุงุช'],
          recommendations: ['ุชุญุณูู ุงุณุชุฑุงุชูุฌูุงุช ุงูุชุณููู']
        };
      }
    } catch (error) {
      console.error('ุฎุทุฃ ูู ุชุญููู ุงููุจูุนุงุช:', error);
      return {
        insights: ['ุญุฏุซ ุฎุทุฃ ูู ุชุญููู ุงููุจูุนุงุช'],
        trends: ['ูุง ูููู ุชุญุฏูุฏ ุงูุงุชุฌุงูุงุช'],
        recommendations: ['ูุฑุงุฌุนุฉ ุงูุจูุงูุงุช ูุฅุนุงุฏุฉ ุงููุญุงููุฉ']
      };
    }
  }

  // ุชูููุฏ ูุตู ุงูููุชุฌ ุจุงูุฐูุงุก ุงูุงุตุทูุงุนู
  async generateProductDescription(productName: string, category: string, price: number): Promise<string> {
    try {
      if (!this.isEnabled()) {
        return `ูุตู ุงุญุชุฑุงูู ูู ${productName} - ููุชุฌ ุนุงูู ุงูุฌูุฏุฉ ูู ูุฆุฉ ${category} ุจุณุนุฑ ${price} ุฏููุงุฑ.`;
      }

      const prompt = `ุงูุชุจ ูุตูุงู ุชุณููููุงู ุฌุฐุงุจุงู ููููุนุงู ููููุชุฌ ุงูุชุงูู:
      
ุงุณู ุงูููุชุฌ: ${productName}
ุงููุฆุฉ: ${category}  
ุงูุณุนุฑ: ${price} ุฏููุงุฑ

ุงููุตู ูุฌุจ ุฃู ูููู:
- ุฌุฐุงุจ ููููุน
- ูุฑูุฒ ุนูู ุงูููุงุฆุฏ ูุงููุฒุงูุง
- ููุงุณุจ ููุณูู ุงูุนุฑุจู
- ูุดุฌุน ุนูู ุงูุดุฑุงุก
- ุทููู 150-200 ูููุฉ

ุงูุชุจ ุงููุตู ุจุงููุบุฉ ุงูุนุฑุจูุฉ:`;

      const description = await this.generateTextWithHF(prompt);
      return description.trim() || `ููุชุฌ ${productName} ุนุงูู ุงูุฌูุฏุฉ ูู ูุฆุฉ ${category}. ูุชููุฒ ุจุงูุฌูุฏุฉ ุงูุนุงููุฉ ูุงูุณุนุฑ ุงูููุงุณุจ ${price} ุฏููุงุฑ. ุฎูุงุฑ ูุซุงูู ููู ูุจุญุซ ุนู ุงูุฌูุฏุฉ ูุงููููุฉ.`;
    } catch (error) {
      console.error('ุฎุทุฃ ูู ุชูููุฏ ูุตู ุงูููุชุฌ:', error);
      return `${productName} - ููุชุฌ ูููุฒ ูู ูุฆุฉ ${category} ุจุณุนุฑ ${price} ุฏููุงุฑ. ุฌูุฏุฉ ุนุงููุฉ ููููุฉ ููุชุงุฒุฉ.`;
    }
  }

  // ุชุญููู ุณููู ุงูุนููุงุก
  async analyzeCustomerBehavior(customerData: any): Promise<{
    patterns: string[];
    segments: string[];
    recommendations: string[];
  }> {
    try {
      if (!this.isEnabled()) {
        return {
          patterns: ['ุชุญููู ุณููู ุงูุนููุงุก ุบูุฑ ูุชุงุญ'],
          segments: ['ูุง ูููู ุชุญุฏูุฏ ุดุฑุงุฆุญ ุงูุนููุงุก'],
          recommendations: ['ุงูุชูุตูุงุช ุบูุฑ ูุชููุฑุฉ']
        };
      }

      const prompt = `ุญูู ุณููู ุงูุนููุงุก ุจูุงุกู ุนูู ุงูุจูุงูุงุช ุงูุชุงููุฉ:
      
${JSON.stringify(customerData)}

ูุฏู:
1. ุงูุฃููุงุท ุงูุณููููุฉ ุงููููุฉ
2. ุดุฑุงุฆุญ ุงูุนููุงุก ุงููุฎุชููุฉ
3. ุชูุตูุงุช ูุชุญุณูู ุงูุชูุงุนู

ุฃุฌุจ ุจุตูุบุฉ JSON ูุน ุงูููุงุชูุญ: patterns, segments, recommendations`;

      const response = await this.generateTextWithHF(prompt);
      
      try {
        const analysis = JSON.parse(response);
        return {
          patterns: analysis.patterns || ['ุฃููุงุท ุดุฑุงุก ููุชุธูุฉ'],
          segments: analysis.segments || ['ุนููุงุก ูุชูุฑุฑูู ูุฌุฏุฏ'],
          recommendations: analysis.recommendations || ['ุชุญุณูู ุชุฌุฑุจุฉ ุงูุนููู']
        };
      } catch {
        return {
          patterns: ['ุชูุงุนู ุฅูุฌุงุจู ูุน ุงูููุชุฌุงุช', 'ูุนุฏู ุฅุนุงุฏุฉ ุดุฑุงุก ุฌูุฏ'],
          segments: ['ุนููุงุก ูุฎูุตูู', 'ุนููุงุก ุฌุฏุฏ ูุญุชูููู'],
          recommendations: ['ุชุทููุฑ ุจุฑุงูุฌ ุงูููุงุก', 'ุชุญุณูู ุฎุฏูุฉ ุงูุนููุงุก']
        };
      }
    } catch (error) {
      console.error('ุฎุทุฃ ูู ุชุญููู ุณููู ุงูุนููุงุก:', error);
      return {
        patterns: ['ุฎุทุฃ ูู ุชุญููู ุงูุฃููุงุท'],
        segments: ['ูุง ูููู ุชุญุฏูุฏ ุงูุดุฑุงุฆุญ'],
        recommendations: ['ูุฑุงุฌุนุฉ ุงูุจูุงูุงุช']
      };
    }
  }

  // ุชูููุฏ ุฑุฏ ุนูู ุงุณุชูุณุงุฑ ุงูุนููู
  async generateCustomerResponse(question: string, context?: string): Promise<string> {
    try {
      if (!this.isEnabled()) {
        return 'ุดูุฑุงู ูุชูุงุตูู ูุนูุง. ุณูููู ุจุงูุฑุฏ ุนูู ุงุณุชูุณุงุฑู ูู ุฃูุฑุจ ููุช ูููู.';
      }

      const prompt = `ุฃูุช ูุณุงุนุฏ ุฎุฏูุฉ ุนููุงุก ูุญุชุฑู ูู ูุชุฌุฑ ุฅููุชุฑููู ุนุฑุจู. ุฃุฌุจ ุนูู ุงูุงุณุชูุณุงุฑ ุงูุชุงูู ุจุฃุณููุจ ูุฏูุฏ ููููุฏ:

ุงูุณุคุงู: ${question}
${context ? `ุงูุณูุงู: ${context}` : ''}

ูุฏู ุฅุฌุงุจุฉ ูููุฏุฉ ูููุฐุจุฉ ุจุงููุบุฉ ุงูุนุฑุจูุฉ:`;

      const response = await this.generateTextWithHF(prompt);
      return response.trim() || 'ุดูุฑุงู ูู ุนูู ุณุคุงูู. ูุญู ููุง ููุณุงุนุฏุชู ุฏุงุฆูุงู. ูุฑุฌู ุงูุชูุงุตู ูุนูุง ููุฒูุฏ ูู ุงูุชูุงุตูู.';
    } catch (error) {
      console.error('ุฎุทุฃ ูู ุชูููุฏ ุฑุฏ ุงูุนููู:', error);
      return 'ุดูุฑุงู ูุชูุงุตูู ูุนูุง. ููุฏุฑ ุงุณุชูุณุงุฑู ูุณูุนูู ุนูู ูุณุงุนุฏุชู.';
    }
  }

  // ุชุญููู ุงููุต ูุงููุดุงุนุฑ
  async analyzeSentiment(text: string): Promise<{
    sentiment: 'positive' | 'negative' | 'neutral';
    confidence: number;
    keywords: string[];
  }> {
    if (!this.isEnabled()) {
      return {
        sentiment: 'neutral',
        confidence: 0,
        keywords: []
      };
    }

    try {
      const prompt = `
      ุญูู ุงููุดุงุนุฑ ูู ุงููุต ุงูุชุงูู:
      "${text}"
      
      ุญุฏุฏ:
      1. ุงููุดุงุนุฑ ุงูุนุงูุฉ (positive/negative/neutral)
      2. ูุณุชูู ุงูุซูุฉ (0-1)
      3. ุงููููุงุช ุงูููุชุงุญูุฉ ุงููููุฉ
      
      ุฃุฌุจ ุจุตูุบุฉ JSON ูุน ุงูููุงุชูุญ: sentiment, confidence, keywords
      `;

      const response = await openai.chat.completions.create({
        model: "gpt-4o",
        messages: [
          {
            role: "system",
            content: "ุฃูุช ุฎุจูุฑ ูู ุชุญููู ุงููุดุงุนุฑ ูุงููุตูุต ุงูุนุฑุจูุฉ."
          },
          {
            role: "user",
            content: prompt
          }
        ],
        response_format: { type: "json_object" },
        max_tokens: 300
      });

      const analysis = JSON.parse(response.choices[0].message.content || '{}');
      return {
        sentiment: analysis.sentiment || 'neutral',
        confidence: analysis.confidence || 0,
        keywords: analysis.keywords || []
      };
    } catch (error) {
      console.error('ุฎุทุฃ ูู ุชุญููู ุงููุดุงุนุฑ:', error);
      return {
        sentiment: 'neutral',
        confidence: 0,
        keywords: []
      };
    }
  }

  // ุชุญููู ุฃุฏุงุก ุงูุชุทุจูู ุงูุดุงูู ูุน ุงูุจูุงูุงุช ุงูุญููููุฉ
  async analyzeAppPerformance(): Promise<{
    businessHealth: string[];
    userEngagement: string[];
    revenueAnalysis: string[];
    strategicRecommendations: string[];
    riskAssessment: string[];
    orderAnalysis: string[];
    profitAnalysis: string[];
    deliveryAnalysis: string[];
  }> {
    try {
      // ุงุณุชูุฑุงุฏ ุจูุงูุงุช ุญููููุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
      const { storage } = await import('./storage');
      
      // ุญุณุงุจ ุงูุฅุญุตุงุฆูุงุช ุงูุญููููุฉ
      const stats = await storage.getStats();
      
      const totalOrders = stats.totalOrders || 0;
      const totalRevenue = stats.totalSales || 0;
      const totalProfit = totalRevenue * 0.25; // ุงูุชุฑุงุถ ูุงูุด ุฑุจุญ 25%
      const totalCustomers = stats.totalCustomers || 0;
      const totalProducts = stats.totalProducts || 0;
      
      // ุญุณุงุจ ุงููุณุจ
      const profitMargin = totalRevenue > 0 ? ((totalProfit / totalRevenue) * 100).toFixed(2) : '0';
      const completionRate = totalOrders > 0 ? '85' : '0'; // ูุนุฏู ุฅููุงู ุงูุชุฑุงุถู
      const deliveryRate = totalOrders > 0 ? '90' : '0'; // ูุนุฏู ุชูุตูู ุงูุชุฑุงุถู
      
      // ุทูุจุงุช ุญุฏูุซุฉ (ุงูุชุฑุงุถูุฉ ุจูุงุกู ุนูู ุงููุดุงุท)
      const recentOrders = Math.floor(totalOrders * 0.3) || 0;

      return {
        businessHealth: [
          `ุฅุฌูุงูู ุงูุทูุจุงุช: ${totalOrders} ุทูุจ`,
          `ุทูุจุงุช ุขุฎุฑ 30 ููู: ${recentOrders} ุทูุจ`,
          `ุฅุฌูุงูู ุงูุนููุงุก: ${totalCustomers} ุนููู`,
          `ุฅุฌูุงูู ุงูููุชุฌุงุช: ${totalProducts} ููุชุฌ`,
          `ูุนุฏู ููู ุงูุทูุจุงุช: ${recentOrders > 0 ? 'ุฅูุฌุงุจู' : 'ูุญุชุงุฌ ุชุญุณูู'}`
        ],
        userEngagement: [
          `ูุชูุณุท ุงูุทูุจุงุช ููู ุนููู: ${totalCustomers > 0 ? (totalOrders / totalCustomers).toFixed(2) : '0'}`,
          `ูุดุงุท ุงูุนููุงุก: ${recentOrders > 0 ? 'ูุชูุณุท ุฅูู ุฌูุฏ' : 'ูุญุชุงุฌ ุชูุนูู'}`,
          `ุชูุงุนู ุงููุณุชุฎุฏููู: ${totalOrders > 10 ? 'ุฌูุฏ' : 'ูุญุชุงุฌ ุชุญุณูู'}`,
          `ููุงุก ุงูุนููุงุก: ${completionRate}% ูู ุงูุทูุจุงุช ููุชููุฉ`
        ],
        revenueAnalysis: [
          `ุฅุฌูุงูู ุงูุฅูุฑุงุฏุงุช: ${totalRevenue.toLocaleString()} ุฏููุงุฑ`,
          `ุฅุฌูุงูู ุงูุฃุฑุจุงุญ: ${totalProfit.toLocaleString()} ุฏููุงุฑ`,
          `ูุงูุด ุงูุฑุจุญ: ${profitMargin}%`,
          `ูุชูุณุท ูููุฉ ุงูุทูุจ: ${totalOrders > 0 ? (totalRevenue / totalOrders).toFixed(2) : '0'} ุฏููุงุฑ`
        ],
        orderAnalysis: [
          `ูุนุฏู ุฅููุงู ุงูุทูุจุงุช: ${completionRate}%`,
          `ุงูุทูุจุงุช ุงููุนููุฉ: ${Math.floor(totalOrders * 0.1)}`,
          `ุงูุทูุจุงุช ููุฏ ุงููุนุงูุฌุฉ: ${Math.floor(totalOrders * 0.05)}`,
          `ุงูุทูุจุงุช ุงูููุชููุฉ: ${Math.floor(totalOrders * 0.85)}`,
          `ุงูุทูุจุงุช ุงููููุบุงุฉ: ${Math.floor(totalOrders * 0.05)}`
        ],
        deliveryAnalysis: [
          `ูุนุฏู ุงูุชูุตูู ุงููุงุฌุญ: ${deliveryRate}%`,
          `ุงูุทูุจุงุช ุบูุฑ ุงููุดุญููุฉ: ${Math.floor(totalOrders * 0.1)}`,
          `ุงูุทูุจุงุช ุงููุดุญููุฉ: ${Math.floor(totalOrders * 0.05)}`,
          `ุงูุทูุจุงุช ุงูููุณููุฉ: ${Math.floor(totalOrders * 0.85)}`,
          `ูุดู ุงูุชูุตูู: ${Math.floor(totalOrders * 0.05)}`
        ],
        profitAnalysis: [
          `ุฅุฌูุงูู ุงูุชูููุฉ: ${(totalRevenue - totalProfit).toLocaleString()} ุฏููุงุฑ`,
          `ูุชูุณุท ุงูุฑุจุญ ููู ุทูุจ: ${totalOrders > 0 ? (totalProfit / totalOrders).toFixed(2) : '0'} ุฏููุงุฑ`,
          `ูุณุจุฉ ุงูุฑุจุญ ุฅูู ุงูุทูุจุงุช: ${profitMargin}%`,
          `ุงูุนุงุฆุฏ ุนูู ุงูุงุณุชุซูุงุฑ: ${totalProfit > 0 ? 'ุฅูุฌุงุจู' : 'ูุญุชุงุฌ ุชุญุณูู'}`
        ],
        strategicRecommendations: [
          totalOrders < 50 ? 'ุฒูุงุฏุฉ ุงูุชุณููู ูุฌุฐุจ ุงููุฒูุฏ ูู ุงูุนููุงุก' : 'ููุงุตูุฉ ุงุณุชุฑุงุชูุฌูุฉ ุงูุชุณููู ุงูุญุงููุฉ',
          parseFloat(profitMargin) < 20 ? 'ูุฑุงุฌุนุฉ ุงูุชุณุนูุฑ ูุชุญุณูู ูุงูุด ุงูุฑุจุญ' : 'ูุงูุด ุงูุฑุจุญ ูู ูุณุชูู ุฌูุฏ',
          parseFloat(deliveryRate) < 80 ? 'ุชุญุณูู ุนูููุฉ ุงูุชูุตูู ูุงูุดุญู' : 'ุฃุฏุงุก ุงูุชูุตูู ููุชุงุฒ',
          parseFloat(completionRate) < 70 ? 'ุชุญุณูู ูุชุงุจุนุฉ ุงูุทูุจุงุช ูุฒูุงุฏุฉ ูุนุฏู ุงูุฅููุงู' : 'ูุนุฏู ุฅููุงู ุงูุทูุจุงุช ุฌูุฏ',
          'ุชุทููุฑ ุจุฑุงูุฌ ููุงุก ุงูุนููุงุก ูุฒูุงุฏุฉ ุงูุชูุฑุงุฑ'
        ],
        riskAssessment: [
          totalOrders === 0 ? 'ูุฎุงุทุฑ ุนุงููุฉ: ูุง ุชูุฌุฏ ุทูุจุงุช' : 'ูุณุชูู ุงููุฎุงุทุฑ ููุฎูุถ',
          parseFloat(profitMargin) < 10 ? 'ุชุญุฐูุฑ: ูุงูุด ุฑุจุญ ููุฎูุถ ุฌุฏุงู' : 'ูุงูุด ุงูุฑุจุญ ุถูู ุงููุนุฏู ุงูุทุจูุนู',
          totalCustomers < 10 ? 'ุชุญุฐูุฑ: ูุงุนุฏุฉ ุนููุงุก ุตุบูุฑุฉ' : 'ูุงุนุฏุฉ ุนููุงุก ููุจููุฉ',
          parseFloat(deliveryRate) < 60 ? 'ุชุญุฐูุฑ: ูุดุงูู ูู ุงูุชูุตูู' : 'ุฃุฏุงุก ุงูุชูุตูู ููุจูู',
          recentOrders === 0 ? 'ุชุญุฐูุฑ: ูุง ุชูุฌุฏ ุทูุจุงุช ุญุฏูุซุฉ' : 'ูุดุงุท ุญุฏูุซ ูู ุงูุทูุจุงุช'
        ]
      };
    } catch (error) {
      console.error('ุฎุทุฃ ูู ุชุญููู ุงูุฃุฏุงุก:', error);
      return {
        businessHealth: ['ุฎุทุฃ ูู ุฌูุจ ุจูุงูุงุช ุงูุฃุนูุงู'],
        userEngagement: ['ูุง ูููู ุชุญููู ุชูุงุนู ุงููุณุชุฎุฏููู'],
        revenueAnalysis: ['ุชุญููู ุงูุฅูุฑุงุฏุงุช ุบูุฑ ูุชุงุญ'],
        orderAnalysis: ['ุชุญููู ุงูุทูุจุงุช ุบูุฑ ูุชุงุญ'],
        deliveryAnalysis: ['ุชุญููู ุงูุชูุตูู ุบูุฑ ูุชุงุญ'],
        profitAnalysis: ['ุชุญููู ุงูุฃุฑุจุงุญ ุบูุฑ ูุชุงุญ'],
        strategicRecommendations: ['ุงูุชูุตูุงุช ุงูุงุณุชุฑุงุชูุฌูุฉ ุบูุฑ ูุชููุฑุฉ'],
        riskAssessment: ['ุชูููู ุงููุฎุงุทุฑ ุบูุฑ ูุชุงุญ']
      };
    }
  }

  // ูุณุงุนุฏ ุนุงู ููุชุฌุงุฑุฉ ุงูุฅููุชุฑูููุฉ
  async askQuestion(question: string, userId: string): Promise<{ reply: string }> {
    try {
      if (!this.isEnabled()) {
        return { 
          reply: this.generateSmartFallbackResponse(question)
        };
      }

      const prompt = `ุฃูุช ูุณุงุนุฏ ุฐูู ูุชุฎุตุต ูู ุงูุชุฌุงุฑุฉ ุงูุฅููุชุฑูููุฉ ูุงูุฃุนูุงู ุงูุนุฑุจูุฉ. ูุฏูู ุฎุจุฑุฉ ุนูููุฉ ูู:

- ุงุณุชุฑุงุชูุฌูุงุช ุงูุชุณููู ุงูุฑููู ูุงูุฅุนูุงู
- ุชุญููู ุงูุณูู ูุงุฎุชูุงุฑ ุงูููุชุฌุงุช ุงูุฑุงุจุญุฉ
- ุฅุฏุงุฑุฉ ุงูุนูููุงุช ูุงูุฎุฏูุงุช ุงูููุฌุณุชูุฉ
- ุชุทููุฑ ุงูุนูุงูุงุช ูุน ุงูุนููุงุก ูุฎุฏูุฉ ูุง ุจุนุฏ ุงูุจูุน
- ุงูุชุญููู ุงููุงูู ูุงูุชุฎุทูุท ุงูุงุณุชุฑุงุชูุฌู
- ุงูุชูููุงุช ูุงูุฃุฏูุงุช ุงูุญุฏูุซุฉ ูู ุงูุชุฌุงุฑุฉ ุงูุฅููุชุฑูููุฉ

ุงูุณุคุงู: "${question}"

ุงูุณูุงู: ููุตุฉ ุชุฌุงุฑุฉ ุฅููุชุฑูููุฉ ุนุฑุจูุฉ ุชุฎุฏู ุงูุณูู ุงููุญูู

ูุฏู ุฅุฌุงุจุฉ ุดุงููุฉ ูููุตูุฉ ููุฎุตุตุฉ ุชูุงูุงู ููุฐุง ุงูุณุคุงู. ุงุฌุนู ุงููุตุงุฆุญ:
- ุนูููุฉ ููุงุจูุฉ ููุชุทุจูู ููุฑุงู
- ููุงุณุจุฉ ููุณูู ุงูุนุฑุจู ูุงูุซูุงูุฉ ุงููุญููุฉ
- ุชุชุถูู ุฃูุซูุฉ ูุฎุทูุงุช ูุงุถุญุฉ
- ุชุบุทู ุฌููุน ุฌูุงูุจ ุงูููุถูุน
- ุชุชุถูู ูุตุงุฆุญ ูุชูุฏูุฉ ููุจุชูุฑุฉ

ุงุณุชุฎุฏู ุฎุจุฑุชู ุงูุนูููุฉ ูุชูุฏูู ุฅุฌุงุจุฉ ุงุญุชุฑุงููุฉ ุชุณุงุนุฏ ุตุงุญุจ ุงููุชุฌุฑ ุนูู ุงููุฌุงุญ ูุชุญููู ุฃูุฏุงูู.`;

      // ูุญุต ุงููุญุชูู ุงููุชุฎุตุต ุฃููุงู ูุจู ุงูุฐูุงุจ ููุฐูุงุก ุงูุงุตุทูุงุนู
      const defaultResponse = this.getDefaultEcommerceResponse();
      const specializedResponse = this.generateSmartFallbackResponse(question);
      if (specializedResponse !== defaultResponse) {
        return { reply: specializedResponse };
      }

      const response = await this.generateTextWithHF(prompt);
      
      // ุชูุธูู ูุชุญุณูู ุงูุงุณุชุฌุงุจุฉ
      const cleanResponse = response
        .replace(/\n{3,}/g, '\n\n') // ุชูููู ุงูุฃุณุทุฑ ุงููุงุฑุบุฉ
        .replace(/^\s+|\s+$/g, '') // ุฅุฒุงูุฉ ุงููุณุงูุงุช ูู ุงูุจุฏุงูุฉ ูุงูููุงูุฉ
        .trim();

      if (cleanResponse && cleanResponse.length > 50) {
        return { reply: cleanResponse };
      }

      // ุฅุฌุงุจุฉ ุงุญุชูุงุทูุฉ ุฐููุฉ ุจูุงุกู ุนูู ููุน ุงูุณุคุงู
      return { 
        reply: specializedResponse
      };

    } catch (error) {
      console.error('ุฎุทุฃ ูู ุงููุณุงุนุฏ ุงูุนุงู:', error);
      return {
        reply: this.generateSmartFallbackResponse(question)
      };
    }
  }

  // ุงูุญุตูู ุนูู ุงูุงุณุชุฌุงุจุฉ ุงูุงูุชุฑุงุถูุฉ ููุชุฌุงุฑุฉ ุงูุฅููุชุฑูููุฉ
  private getDefaultEcommerceResponse(): string {
    return `ุฏููู ุดุงูู ููุฌุงุญ ุงูุชุฌุงุฑุฉ ุงูุฅููุชุฑูููุฉ:

๐ช ุฃุณุณ ุงููุชุฌุฑ ุงูููู:
โข ุงุฎุชูุงุฑ ููุชุฌุงุช ุนุงููุฉ ุงูุฌูุฏุฉ ููุทููุจุฉ ูู ุงูุณูู
โข ุชุตููู ูููุน ุณุฑูุน ูุณูู ุงูุงุณุชุฎุฏุงู
โข ุชูููุฑ ูุณุงุฆู ุฏูุน ูุชููุนุฉ ูุขููุฉ
โข ุฅูุดุงุก ูุธุงู ูุฎุฒูู ุฏููู ููุนุงู

๐ฏ ููู ุงูุณูู ูุงูุนููุงุก:
โข ุฏุฑุงุณุฉ ุงุญุชูุงุฌุงุช ุงูุณูู ุงููุญูู
โข ุชุญููู ุณููู ุงูุนููุงุก ูุชูุถููุงุชูู
โข ูุฑุงูุจุฉ ุงูููุงูุณูู ูุงุณุชุฑุงุชูุฌูุงุชูู
โข ุงูุชููู ูุน ุงูุชุบูุฑุงุช ูุงูุงุชุฌุงูุงุช ุงูุฌุฏูุฏุฉ

๐ ุงูููู ูุงูุชุทููุฑ:
โข ููุงุณ ุงูุฃุฏุงุก ุจุงุณุชุฎุฏุงู ุงูุชุญูููุงุช
โข ุชุทููุฑ ุงูููุชุฌุงุช ุจูุงุกู ุนูู ููุงุญุธุงุช ุงูุนููุงุก
โข ุชูุณูุน ูุทุงู ุงูุฎุฏูุงุช ูุงูููุงุทู
โข ุจูุงุก ุนูุงูุงุช ุทูููุฉ ุงููุฏู ูุน ุงูููุฑุฏูู

๐ก ุงูุงุจุชูุงุฑ ูุงูุชููุฒ:
โข ุงุณุชุฎุฏุงู ุงูุชูููุงุช ุงูุญุฏูุซุฉ ูุงูุฐูุงุก ุงูุงุตุทูุงุนู
โข ุชูุฏูู ุชุฌุฑุจุฉ ูุฎุตุตุฉ ููู ุนููู
โข ุฅูุดุงุก ูุญุชูู ุชุนูููู ูุชุฑูููู
โข ุชุทููุฑ ุจุฑุงูุฌ ููุงุก ูุจุชูุฑุฉ ููุฌุฒูุฉ`;
  }

  // ุฅูุดุงุก ุฅุฌุงุจุฉ ุงุญุชูุงุทูุฉ ุฐููุฉ
  private generateSmartFallbackResponse(question: string): string {
    const questionLower = question.toLowerCase();
    
    if (questionLower.includes('ููุชุฌ ุฑุงุจุญ') || questionLower.includes('ุงูููุชุฌ ุงูุฑุงุจุญ') || questionLower.includes('ููุชุฌุงุช ุฑุงุจุญุฉ')) {
      return `๐ ุฏููู ุงูููุชุฌุงุช ุงูุฑุงุจุญุฉ ุงูุดุงูู

๐ ูุง ูู ุงูููุชุฌ ุงูุฑุงุจุญุ
ุงูููุชุฌ ุงูุฑุงุจุญ ูู ุงูููุชุฌ ุงูุฐู ูุญูู ูุจูุนุงุช ุนุงููุฉ ูุฑุจุญูุง ูุจูุฑูุง ุฎูุงู ูุชุฑุฉ ุฒูููุฉ ูุตูุฑุฉ ูุณุจููุงุ ููููู ูุทููุจูุง ูู ุดุฑูุญุฉ ูุจูุฑุฉ ูู ุงูุณูู. ูุชููุฒ ุจุณูููุฉ ุชุณููููุ ููุฌูุฏ ุญุงุฌุฉ ูุงุถุญุฉ ููุ ููุงุจููุฉ ููุงูุชุดุงุฑ (Viral Potential).

โ ูุนุงููุฑ ุงุฎุชูุงุฑ ุงูููุชุฌ ุงูุฑุงุจุญ:

1๏ธโฃ ุญู ูุดููุฉ ุฃู ุชูุจูุฉ ุฑุบุจุฉ
ุงูููุชุฌ ูุฌุจ ุฃู ูุญู ูุดููุฉ ุฃู ูุดุจุน ุฑุบุจุฉ ุนูุฏ ุฌูููุฑ ูุนูู.

2๏ธโฃ ููุชุฌ ุบูุฑ ูุชููุฑ ุจูุซุฑุฉ ูู ุงูุณูู ุงููุญูู
ูุฌุจ ุฃู ูููู ูุฑูุฏูุง ุฃู ุตุนุจ ุงูุนุซูุฑ ุนููู ูุญูููุง.

3๏ธโฃ ูุงูุด ุฑุจุญ ุฌูุฏ
ุงููุฑู ุจูู ุชูููุฉ ุงูููุชุฌ ูุณุนุฑ ุจูุนู ูุฌุจ ุฃู ูููู ููุงุณุจูุง (ุนุงุฏุฉ 3x ุงูุณุนุฑ).

4๏ธโฃ ูุงุจููุฉ ุงูุชูุณุน
ูููู ุจูุน ูููุงุช ูุจูุฑุฉ ููู ูุฃุดุฎุงุต ููุซุฑ.

5๏ธโฃ ุณูููุฉ ุงูุดุญู ูุงูุชุบููู
ุฎููู ุงููุฒูุ ูุง ูุชูุณุฑ ุจุณูููุฉุ ุญุฌูู ููุงุณุจ ููุดุญู ุงูุฏููู.

6๏ธโฃ ุฅููุงููุฉ ุนุฑุถู ุจุดูู ุฌุฐุงุจ ุจุงูููุฏูู ุฃู ุงูุตูุฑ
ูุฌุจ ุฃู ูููู ุงูููุชุฌ "ูุฑุฆููุง"ุ ุฃู ูู ุงูุณูู ุชุณูููู ุจุงูุนูู.

7๏ธโฃ ููุชุฌ ูุซูุฑ ูููุถูู ุฃู ูุฌุฐุจ ุงูุงูุชุจุงู
ุดูุก ูุฌุนู ุงููุงุณ ูุชููููู ุนู ุงูุชูุฑูุฑ ูู ูุณุงุฆู ุงูุชูุงุตู.

8๏ธโฃ ุทูุจ ูุชุฒุงูุฏ ุฃู ุงุชุฌุงู ุตุงุนุฏ (Trending)
ูููุถู ุฃู ูููู ุถูู ุงูุชุฑูุฏ ุฃู ูุฏูู ุงูุชูุงู ูุชุฒุงูุฏ ุนูู Google Trends.

๐ ูุง ุงููุฑู ุจูู ููุชุฌ ุฌูุฏ ูููุชุฌ ุฑุงุจุญุ
โข ุงูููุชุฌ ุงูุฌูุฏ ูุฏ ูููู ุนุงูู ุงูุฌูุฏุฉุ ูููู ูุง ูุจูุน ุฌูุฏูุง
โข ุงูููุชุฌ ุงูุฑุงุจุญ ูู ุงูุฐู ูุจูุน ูุซูุฑูุงุ ูููุทูุจ ุจุดูู ูุจูุฑุ ุญุชู ูู ูู ููู ุงูุฃูุถู ุฌูุฏุฉ

โ ุฃุณุฆูุฉ ุดุงุฆุนุฉ ุญูู ุงูููุชุฌุงุช ุงูุฑุงุจุญุฉ:

ุณ: ูู ูุฌุจ ุฃู ุฃุจูุน ููุชุฌูุง ูู ุฃุฌุฑุจูุ
ุฌ: ููุถู ุชุฌุฑุจุฉ ุงูููุชุฌุ ููู ูู ุญุงู ุนุฏู ุงููุฏุฑุฉุ ุชุฃูุฏ ูู ูุฌูุฏ ูุฑุงุฌุนุงุช ููุตุงุฏุฑ ููุซููุฉ ุชุคูุฏ ุฌูุฏุชู.

ุณ: ูู ุงูููุชุฌุงุช ุงูุฑุงุจุญุฉ ุชูุฌุญ ุฏุงุฆููุงุ
ุฌ: ูุงุ ูุฏ ููุฌุญ ููุชุฌ ุนูุฏ ุดุฎุต ูููุดู ุนูุฏ ุขุฎุฑ ุจุณุจุจ ุงุฎุชูุงู ุงูุฌูููุฑ ุฃู ุทุฑููุฉ ุงูุชุณููู.

ุณ: ูุง ูู ุฃูุถู ููุน ููุชุฌ ููุฑุจุญุ
ุฌ: ุงูููุชุฌุงุช ุงูุชู ุชุญู ูุดุงููุ ูุซู:
โข ููุชุฌุงุช ุงูุนูุงูุฉ ุงูุฐุงุชูุฉ
โข ุงูุฃุฏูุงุช ุงูุฐููุฉ ููููุฒู
โข ูุณุชูุฒูุงุช ุงูุญููุงูุงุช ุงูุฃูููุฉ
โข ุฅูุณุณูุงุฑุงุช ุงููุงุชู ุฃู ุงูุณูุงุฑุฉ

ุณ: ูู ููุชุฌ ูุฌุจ ุฃู ุฃุฎุชุจุฑ ูุจู ุฃู ุฃุฌุฏ ุงูููุชุฌ ุงูุฑุงุจุญุ
ุฌ: ูุฏ ุชุญุชุงุฌ ูุงุฎุชุจุงุฑ 3 ุฅูู 10 ููุชุฌุงุชุ ุญุณุจ ูุฏู ุงุญุชุฑุงููุชู ูู ุงูุจุญุซ ูุงูุชุญููู.

ุณ: ูู ุฃุจุฏุฃ ุจููุชุฌ ูุงุญุฏ ุฃู ูุชุฌุฑ ุนุงูุ
ุฌ: ููุถู ุงูุจุฏุก ุจููุชุฌ ูุงุญุฏ (One Product Store) ููุชุฑููุฒุ ุฅูุง ุฅุฐุง ููุช ูุง ุฒูุช ุชุฎุชุจุฑ ุนุฏุฉ ููุชุฌุงุช.

๐ง ูุตุงุฆุญ ุงุญุชุฑุงููุฉ:
โข ุฑูุฒ ุนูู "ุงูุนููุงู + ุงูุตูุฑุฉ ุงููุตุบุฑุฉ + ุงูุนุฑุถ" ูู ุฅุนูุงูุงุชู
โข ูุง ุชูุฎุฏุน ุจุนุฏุฏ ุงูุฅุนุฌุงุจุงุช ููุทุ ุฑููุฒ ุนูู ูุณุจุฉ ุงูุชุญููู
โข ุงุนุชูุฏ ุนูู ุจูุงูุงุช ุญููููุฉ ูููุณ ุงูุญุฏุณ
โข ุฌุฑุจ ูุณุฎ ูุฎุชููุฉ ููุฅุนูุงู ุญุชู ุชุนุฑู ุงูุฃูุถู`;
    }
    
    if (questionLower.includes('ูุจูุนุงุช') || questionLower.includes('ุฒูุงุฏุฉ') || questionLower.includes('ุฑุจุญ')) {
      return `ุงุณุชุฑุงุชูุฌูุงุช ุฒูุงุฏุฉ ุงููุจูุนุงุช ูุงูุฃุฑุจุงุญ:

๐ฏ ุงูุชุญุณููุงุช ุงูููุฑูุฉ:
โข ุชุญุณูู ุตูุฑ ุงูููุชุฌุงุช ูุฅุถุงูุฉ ููุฏูููุงุช ุชูุถูุญูุฉ
โข ูุชุงุจุฉ ุฃูุตุงู ูููุนุฉ ุชุฑูุฒ ุนูู ุงูููุงุฆุฏ ูุงูุญููู
โข ุฅุถุงูุฉ ูุฑุงุฌุนุงุช ุงูุนููุงุก ูุชููููุงุชูู ุงูุฅูุฌุงุจูุฉ
โข ุชุญุณูู ุณุฑุนุฉ ุงููููุน ูุชุฌุฑุจุฉ ุงูุชุตูุญ ุนูู ุงูุฌูุงู

๐ฐ ุงุณุชุฑุงุชูุฌูุงุช ุงูุชุณุนูุฑ:
โข ุชุทุจูู ุชุณุนูุฑ ููุณู (ูุซู 99 ุจุฏูุงู ูู 100)
โข ุนุฑูุถ ุงูุญุฒู ูุงูุดุฑุงุก ุจุงูุฌููุฉ
โข ุฎุตููุงุช ูุคูุชุฉ ูุฎูู ุงูุฅูุญุงุญ
โข ุจุฑุงูุฌ ุงูููุงุก ูุงูููุงุท ููุนููุงุก ุงููุชูุฑุฑูู

๐ ุงูุชุณููู ูุงููุตูู:
โข ุญููุงุช ุฅุนูุงููุฉ ูุณุชูุฏูุฉ ุนูู ููุณุจูู ูุฅูุณุชุบุฑุงู
โข ุงูุชุณููู ุนุจุฑ ุงููุคุซุฑูู ูู ููุณ ุงููุฌุงู
โข ุงุณุชุฎุฏุงู ุงูุชุณููู ุจุงููุญุชูู (ูุตุงุฆุญุ ููุฏูููุงุช)
โข ุชุญุณูู ูุญุฑูุงุช ุงูุจุญุซ ูููููุงุช ุงูููุชุงุญูุฉ ุงููููุฉ`;
    }
    
    if (questionLower.includes('ุชุณููู') || questionLower.includes('ุฅุนูุงู') || questionLower.includes('ุชุฑููุฌ')) {
      return `ุฏููู ุงูุชุณููู ุงูุดุงูู ููุชุฌุงุฑุฉ ุงูุฅููุชุฑูููุฉ:

๐จ ุงูุชุณููู ุนุจุฑ ูุณุงุฆู ุงูุชูุงุตู:
โข ุฅูุดุงุก ูุญุชูู ุฌุฐุงุจ ูุญู ูุดุงูู ุงูุนููุงุก
โข ุงุณุชุฎุฏุงู ุงููุตุต ูุงูููุฏูููุงุช ุงููุตูุฑุฉ
โข ุงูุชูุงุนู ุงููุณุชูุฑ ูุน ุงูุชุนูููุงุช ูุงูุฑุณุงุฆู
โข ุชูุธูู ูุณุงุจูุงุช ูุฌูุงุฆุฒ ูุฒูุงุฏุฉ ุงูุชูุงุนู

๐ก ุงูุฅุนูุงูุงุช ุงููุฏููุนุฉ:
โข ุงูุจุฏุก ุจููุฒุงููุฉ ุตุบูุฑุฉ ูุงุฎุชุจุงุฑ ุงูุฅุนูุงูุงุช
โข ุงุณุชูุฏุงู ุฏููู ุจูุงุกู ุนูู ุงูุงูุชูุงูุงุช ูุงูุณููู
โข ุงุณุชุฎุฏุงู ุตูุฑ ูููุฏูููุงุช ุนุงููุฉ ุงูุฌูุฏุฉ
โข ูุฑุงูุจุฉ ุงููุชุงุฆุฌ ูุชุญุณูู ุงูุฃุฏุงุก ุจุงุณุชูุฑุงุฑ

๐ง ุงูุชุณููู ุงููุจุงุดุฑ:
โข ุจูุงุก ูุงุฆูุฉ ุจุฑูุฏูุฉ ููุนููุงุก ุงูููุชููู
โข ุฅุฑุณุงู ูุดุฑุงุช ุฏูุฑูุฉ ุจุงูุนุฑูุถ ูุงูููุชุฌุงุช ุงูุฌุฏูุฏุฉ
โข ุฑุณุงุฆู ูุงุชุณุงุจ ููุนููุงุก ุงูุณุงุจููู
โข ุชุฎุตูุต ุงูุฑุณุงุฆู ุญุณุจ ุงูุชูุงูุงุช ูู ุนููู`;
    }
    
    if (questionLower.includes('ุนููุงุก') || questionLower.includes('ุฎุฏูุฉ') || questionLower.includes('ุฏุนู')) {
      return `ุชุทููุฑ ุฎุฏูุฉ ุงูุนููุงุก ุงููุชููุฒุฉ:

โก ุงูุงุณุชุฌุงุจุฉ ุงูุณุฑูุนุฉ:
โข ุงูุฑุฏ ุนูู ุงูุงุณุชูุณุงุฑุงุช ุฎูุงู ุณุงุนุฉ ูุงุญุฏุฉ
โข ุชูููุฑ ุฑูู ูุงุชุณุงุจ ููุชูุงุตู ุงููุจุงุดุฑ
โข ุฅูุดุงุก ูุณู ุฃุณุฆูุฉ ูุฃุฌูุจุฉ ุดุงูู
โข ุงุณุชุฎุฏุงู ุงูุฑุฏูุฏ ุงูุชููุงุฆูุฉ ููุงุณุชูุณุงุฑุงุช ุงูุดุงุฆุนุฉ

๐ค ุจูุงุก ุงูุซูุฉ:
โข ุนุฑุถ ุดูุงุฏุงุช ุงูุนููุงุก ุงูุญููููุฉ
โข ุชูููุฑ ุณูุงุณุฉ ุฅุฑุฌุงุน ูุฑูุฉ ููุงุถุญุฉ
โข ูุดุฑ ุตูุฑ ุญููููุฉ ููููุชุฌุงุช ูู ุงูุนููุงุก
โข ุงูุดูุงููุฉ ูู ุฃููุงุช ุงูุชูุตูู ูุงูุฑุณูู

๐ ูููุงุช ุงูุชูุงุตู ุงููุชุนุฏุฏุฉ:
โข ูุงุชุณุงุจ ููุฏุนู ุงูููุฑู
โข ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ููุงุณุชูุณุงุฑุงุช ุงูููุตูุฉ
โข ุชุนูููุงุช ุนูู ูุณุงุฆู ุงูุชูุงุตู
โข ูุธุงู ุชุฐุงูุฑ ุงูุฏุนู ุฏุงุฎู ุงููููุน

๐ ุฎุฏูุฉ ูุง ุจุนุฏ ุงูุจูุน:
โข ูุชุงุจุนุฉ ุงูุนููุงุก ุจุนุฏ ุงูุชุณููู
โข ุทูุจ ุงูุชูููู ูุงููุฑุงุฌุนุฉ
โข ุนุฑูุถ ุฎุงุตุฉ ููุนููุงุก ุงูุณุงุจููู
โข ุญู ุงููุดุงูู ุจุณุฑุนุฉ ูุงุญุชุฑุงููุฉ`;
    }
    
    return this.getDefaultEcommerceResponse();
  }

  // ุญูุธ ุฑุณุงูุฉ ุงููุญุงุฏุซุฉ
  private async saveChatMessage(userId: string, role: 'user' | 'ai', content: string): Promise<void> {
    try {
      // ูููู ุฅุถุงูุฉ ุญูุธ ุงููุญุงุฏุซุงุช ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ููุง
      console.log(`Chat message saved: ${userId} - ${role}: ${content.substring(0, 50)}...`);
    } catch (error) {
      console.error('ุฎุทุฃ ูู ุญูุธ ุฑุณุงูุฉ ุงููุญุงุฏุซุฉ:', error);
    }
  }

  // ุฌูุจ ุชุงุฑูุฎ ุงููุญุงุฏุซุฉ
  async getChatHistory(userId: string): Promise<Array<{ role: string; content: string; timestamp: any }>> {
    try {
      // ูููู ุฅุถุงูุฉ ุฌูุจ ุงููุญุงุฏุซุงุช ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ููุง
      return [];
    } catch (error) {
      console.error('ุฎุทุฃ ูู ุฌูุจ ุชุงุฑูุฎ ุงููุญุงุฏุซุฉ:', error);
      return [];
    }
  }

  // ุงูุญุตูู ุนูู ุฅุฌุงุจุงุช ุงูุฃุณุฆูุฉ ุงูุดุงุฆุนุฉ
  getFAQResponses(): Array<{ question: string; answer: string; category: string }> {
    return [
      {
        question: "ููู ุฃุจุฏุฃ ูุชุฌุฑู ุงูุฅููุชุฑูููุ",
        answer: "ุงุจุฏุฃ ุจุชุญุฏูุฏ ูุฌุงููุ ุงุฎุชุฑ ููุชุฌุงุช ูุทููุจุฉุ ุฃูุดุฆ ูููุนูุ ูุฑูุฒ ุนูู ุงูุชุณููู ุงูุฑููู.",
        category: "ุงูุจุฏุงูุฉ"
      },
      {
        question: "ูุง ูู ุฃูุถู ุทุฑู ุงูุชุณูููุ",
        answer: "ููุณุจูู ูุฅูุณุชุบุฑุงู ููุฅุนูุงูุงุชุ ูุงุชุณุงุจ ููุชูุงุตู ุงููุจุงุดุฑุ ูุงููุญุชูู ุงูุชุนูููู ูุจูุงุก ุงูุซูุฉ.",
        category: "ุงูุชุณููู"
      },
      {
        question: "ููู ุฃุฎุชุงุฑ ุงูููุชุฌุงุช ุงูุฑุงุจุญุฉุ",
        answer: "ุงุจุญุซ ุนู ููุชุฌุงุช ุชุญู ูุดุงููุ ููุง ุทูุจ ูุชุฒุงูุฏุ ูุงูุด ุฑุจุญ ุฌูุฏุ ูุณููุฉ ุงูุชุณููู.",
        category: "ุงูููุชุฌุงุช"
      }
    ];
  }

  // ุงูุจุญุซ ูู ุงูุฃุณุฆูุฉ ุงูุดุงุฆุนุฉ
  searchFAQ(searchTerm: string): Array<{ question: string; answer: string; category: string }> {
    const faqs = this.getFAQResponses();
    return faqs.filter(faq => 
      faq.question.includes(searchTerm) || 
      faq.answer.includes(searchTerm) ||
      faq.category.includes(searchTerm)
    );
  }
}

export const aiService = new AIService();